== Signing commits

On the template wizard look for **Verify Commits**

image::signed-commits-0.png[]

* "To trigger our secure build pipeline, open VSCode and make a small change to the documentation.

* You click on the *Open Component in Catalog* link.

image::11_Executed_GPT.png[]

* You find and click on the *OpenShift Dev Spaces (VSCode)* link.

image::95_Click_Openshift_Devspaces.png[]

* *OpenShift Dev Spaces* then begins creating your workspace, just like before.

* After waiting a few minutes for *OpenShift Dev Spaces* to finish setting up your workspace, you're presented with your IDE.
* You click the button *Yes, I trust the authors*.

image::96_Trust_Authors.png[]

* "For the purpose of this demo, updating the documentation will be enough to trigger the new build pipeline"
* You expand the docs folder and open the markdown file *index.md*.
* At the document's end, you add: "Build pipeline integrated with security tools."

image::97_Index_Markdown_Updated.png[]

* You click on the *Hamburger button* (three horizontal bars) on the top left of your screen and select *Terminal -> New Terminal*

image::98_Terminal_Menu.png[]

* Run the below command on the *VS Code* terminal to view the Gitsign global git config:
+
[source, role="execute"]
----
git config --global --list
----

NOTE: You may need to allow paste functionality when prompted by the browser.

image::94_Gitsign_Git_Global_Config.png[]

* To begin commiting your code to the repository, run the following command to add your changes to staging:
+
[source, role="execute"]
----
git add .
----
* Run the next command to commit your changes:
+
[source, role="execute"]
----
git commit -m "Doc Update"
----
* You will notice that you receive an error message that states *error opening browser: exec: "xdg-open": executable file not found in $PATH*.  This is because our *VS Code* terminal is trying to open a browser window to obtain your credentials for signing but is unable to as it is running as a container.
* However, Gitsign allows you to provide your signing credentials by copying and pasting the url it outputs into a separate browser window.
* Copy and paste the url into a new browser tab/window and hit enter.

image::90_Gitsign_Commit_Message.png[]

* The browser will prompt you for your credentials.  Enter devspaces username and password.

image::91_Gitsign_Credentials_Prompt.png[]

* You will then be redirected to another page that will present a verification code.  Copy this code into your clipboard.

image::92_Gitsign_Verification_Code.png[]

* Return to *Dev Spaces* and paste this code into the waiting prompt in the *VS Code* terminal and hit enter:
+
[source, role="execute"]
----
Enter verification code:
----

* If successful, you should receive a successful commit message:
+
image::93_Gitsign_Commit_Signed.png[]

* Push the code to the repository with the below command:
+
[source, role="execute"]
----
git push
----

The **verify-commit** will now pass

image::signed-commits-20.png[]

== Setting up local VS Code on Mac

Install gitsign

----
brew tap sigstore/tap
brew install gitsign
----

**git clone** repository to local machine

Take the config from the RHEL9 VS Code machine

image::signed-commits-30.png[]

From the VS Code terminal, run the following command

----
git config --global --edit
----

It should look something like the following:

----
[gitsign]
        fulcio = https://fulcio-server-trusted-artifact-signer.apps.cluster-7gq9c.sandbox2366.opentlc.com
        issuer = https://keycloak-keycloak-system.apps.cluster-7gq9c.sandbox2366.opentlc.com/auth/realms/trusted-artifact-signer
        rekor = https://rekor-server-trusted-artifact-signer.apps.cluster-7gq9c.sandbox2366.opentlc.com
        clientid = trusted-artifact-signer
----

Locally also use `git config --global --edit` to populate the gitsign section

----
git config --local commit.gpgsign true
git config --local tag.gpgsign true
git config --local gpg.x509.program gitsign
git config --local gpg.format x509
----

Make a code chage

----
git commit -S -am "signing from Mac"
----

image::signed-commits-31.png[]

image::signed-commits-32.png[]

image::signed-commits-33.png[]

image::signed-commits-34.png[]



